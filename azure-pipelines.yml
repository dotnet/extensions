#
# See https://docs.microsoft.com/azure/devops/pipelines/yaml-schema for details
#

# Only run CI builds for these branches
trigger:
  branches:
    include:
    - 'master'
    - 'release/*'
    - 'internal/release/*'
# Run PR validation on all branches
pr:
  branches:
    include:
    - '*'

name: $(Date:yyyyMMdd).$(Rev:rr)

resources:
  repositories:
  # Repo: 1ESPipelineTemplates/1ESPipelineTemplates
  - repository: 1esPipelines
    type: git
    name: 1ESPipelineTemplates/1ESPipelineTemplates
    ref: refs/tags/release

extends:
  template: v1/1ES.Official.PipelineTemplate.yml@1esPipelines
  parameters:
    sdl:
      sourceAnalysisPool:
        name: NetCore1ESPool-Svc-Internal
        image: 1es-windows-2022
        os: windows
    stages:
    - stage: build
      displayName: Build
      jobs:
      - template: eng/templates/default-build.yml@self
        parameters:
          agentOs: Windows
          configuration: Release
          codeSign: true
          buildArgs: |
            '/p:PublishBlobFeedKey=$(PB_PublishBlobFeedKey)'
          artifacts:
            publish: true
            name: artifacts
            path: artifacts/
